import pandas as pd

file_path = 'products.csv'

def ultimate_sync():
    print("ğŸš€ æ­£åœ¨åŸ·è¡Œå…¨æ–¹ä½æ•¸æ“šæ ¡æº– (å«è©•åƒ¹æ•¸èˆ‡å‹³ç« )...")
    
    try:
        # è®€å–ä¸¦æ¸…æ´—æ¬„ä½ç©ºæ ¼
        df = pd.read_csv(file_path, encoding='utf-8-sig')
        df.columns = [c.strip() for c in df.columns]

        # å¦‚æœ CSV è£¡é‚„æ²’æœ‰ reviews æ¬„ä½ï¼Œè‡ªå‹•å¹«ä½ è£œä¸Š
        if 'reviews' not in df.columns:
            df['reviews'] = ""

        # å®šç¾©çŸ¥è­˜åº«
        # æ ¼å¼: é—œéµå­—: (æ­£ç¢ºæ¨™é¡Œ, åˆ†é¡æ¨™ç±¤, åƒ¹æ ¼, æ‘˜è¦, è©•åˆ†, å‹³ç« /ä¾†æº, è©•åƒ¹æ•¸)
        kb = {
            "pizzahut": ("å¿…å‹å®¢ Pizza Hutï¼š2025 éš±è—å„ªæƒ ç¢¼å¯¦æ¸¬", "ç¾é£Ÿé¡", "ğŸ• è²·ä¸€é€ä¸€èµ·", "2025 å¿…å‹å®¢éš±è—å„ªæƒ ç¢¼ï¼šåŒ…å«å¤–å¸¶è²·ä¸€é€ä¸€ã€æ¯”è–©å¥—é¤æŠ˜åƒ¹åˆ¸å¯¦æ¸¬å¯ç”¨ã€‚", "4.6", "é£Ÿå®¢çœŸå¯¦å¥½è©•", "10 è¬+"),
            "kfc": ("è‚¯å¾·åŸº KFCï¼šæ¿€çœå„ªæƒ ä»£ç¢¼å¤§å…¨", "ç¾é£Ÿé¡", "ğŸ— æ¿€çœ 5 æŠ˜èµ·", "è‚¯å¾·åŸºä»£ç¢¼å¤§å…¨ï¼šç‚¸é›ã€è›‹å¡”ã€å€‹äººé¤é€šé€šæœ‰å„ªæƒ ï¼Œå¯¦æ¸¬ä»£ç¢¼å¯ç”¨ã€‚", "4.5", "ç”¨æˆ¶æ¨è–¦", "8 è¬+"),
            "klook": ("KLOOK å®¢è·¯ï¼š2025 å…¨çƒæ™¯é»é–€ç¥¨å„ªæƒ ", "æ—…éŠé¡", "âœˆï¸ ç¾æŠ˜ $100", "KLOOK å…¨çƒæ—…éŠå„ªæƒ ç¢¼ï¼šåŒ…å«åœ‹å¤–æ™¯é»é–€ç¥¨ã€äº¤é€šç¥¨åˆ¸éš±è—æŠ˜æ‰£ã€‚", "4.8", "æ—…äººå¥½è©•", "60 è¬+"),
            "kkday": ("KKdayï¼šåœ‹å¤–æ—…éŠé«”é©—èˆ‡æ¥é€æŠ˜æ‰£", "æ—…éŠé¡", "âœˆï¸ æ»¿é¡æŠ˜ $100", "2025 æ—…éŠå¿…å‚™ KKDAY å„ªæƒ æ¸…å–®ï¼ŒåŒ…å«å…¨çƒä¸€æ—¥éŠé«”é©—èˆ‡æ©Ÿå ´æ¥é€æŠ˜æ‰£ã€‚", "4.7", "æ—…äººæ¨è–¦", "30 è¬+"),
            "coupang": ("é…·æ¾ Coupangï¼šç«ç®­è·¨å¢ƒå…é‹æ”»ç•¥", "è³¼ç‰©ç¶²ç«™", "ğŸš€ é¦–è³¼ 7 æŠ˜", "é…·æ¾ç«ç®­è·¨å¢ƒæ”»ç•¥ï¼šéŸ“åœ‹é›¶é£Ÿã€ç”Ÿæ´»ç”¨å“ç›´é€åˆ°å®¶ï¼Œé¦–è³¼é ˜åˆ¸ç¾æŠ˜ 7 æŠ˜ã€‚", "4.9", "æ¥µé€Ÿé…é€å¥½è©•", "100 è¬+"),
            "yahoo": ("Yahoo è³¼ç‰©ä¸­å¿ƒï¼šé™æ™‚é ˜åˆ¸æŠ˜ 15% æ”»ç•¥", "è³¼ç‰©ç¶²ç«™", "ğŸ’° é ˜åˆ¸æŠ˜ 15%", "YAHOO è³¼ç‰©ä¸­å¿ƒé ˜åˆ¸æ•™å­¸ï¼šéš±è—ç‰ˆ 15% å›é¥‹é ˜å–æµç¨‹å¯¦æ¸¬ã€‚", "4.4", "æœƒå“¡è©•é‘‘", "15 è¬+"),
            "carrefour": ("å®¶æ¨‚ç¦ç·šä¸Šè³¼ç‰©ï¼šç•¶æ—¥é…å…æ’éšŠå„ªæƒ ", "è³¼ç‰©ç¶²ç«™", "ğŸ›’ æ»¿é¡æŠ˜ $100", "å®¶æ¨‚ç¦ç·šä¸Šè³¼ç‰©å…æ’éšŠï¼è¼¸å…¥æŠ˜æ‰£ç¢¼ç¾æŠ˜ $100ï¼Œç•¶æ—¥é…é€è¶…æ–¹ä¾¿ã€‚", "4.2", "ç•¶æ—¥é…å¥½è©•", "5 è¬+"),
            "agoda": ("Agoda è¨‚æˆ¿ç‰¹æƒ ï¼šå…¨çƒä½å®¿ 9 æŠ˜æŠ˜æ‰£ç¢¼", "æ—…éŠé¡", "ğŸ¨ è¨‚æˆ¿ 9 æŠ˜èµ·", "Agoda å…¨çƒè¨‚æˆ¿å„ªæƒ ï¼šéš±è—ç‰ˆç‰¹æƒ æŠ˜æ‰£ç¢¼ï¼Œå¯¦æ¸¬åœ‹å…§å¤–ä½å®¿çš†é©ç”¨ã€‚", "4.6", "æ—…äººå¥½è©•", "200 è¬+"),
            "shoppee": ("è¦çš®è³¼ç‰©ï¼š2025 å…é‹åˆ¸èˆ‡æŠ˜åƒ¹åˆ¸æ”»ç•¥", "è³¼ç‰©ç¶²ç«™", "ğŸ å…é‹å„ªæƒ ä¸­", "è¦çš®è³¼ç‰© 2025 å…é‹åˆ¸ã€æŠ˜åƒ¹åˆ¸é ˜å–æ”»ç•¥ã€‚åŒ…å«å•†åŸæŠ˜æ‰£ç¢¼èˆ‡é™æ™‚ç‰¹è³£è³‡è¨Šã€‚", "4.8", "è²·å®¶æ»¿æ„æ¨è–¦", "250 è¬+")
        }

        for index, row in df.iterrows():
            filename = str(row.get('filename', '')).lower()
            current_tags = str(row.get('tags', ''))
            
            for key, val in kb.items():
                if key in filename:
                    # 1. é‡å¯« Title
                    df.at[index, 'title'] = val[0]
                    
                    # 2. æ ¡æº– Tags (åˆ†é¡æ”¾åœ¨ç¬¬ä¸€ä½)
                    category = val[1]
                    if category not in current_tags:
                        clean_tags = current_tags.replace('nan', '').strip()
                        df.at[index, 'tags'] = f"{category}, {clean_tags}".strip(', ')
                    
                    # 3. è£œå…¨å…§å®¹ (price, summary, rating, badge, reviews)
                    mapping = {
                        'price': val[2], 
                        'summary': val[3], 
                        'rating': val[4], 
                        'badge': val[5], 
                        'reviews': val[6]
                    }
                    for col, value in mapping.items():
                        if col in df.columns:
                            # å¦‚æœæ˜¯ç©ºç™½æˆ– nan å°±å¡«å……
                            if pd.isna(df.at[index, col]) or str(df.at[index, col]).strip() in ['', 'nan']:
                                df.at[index, col] = value
                    break

        # æ¸…ç†ä¸¦å„²å­˜
        df = df.replace('nan', '', regex=True)
        df.to_csv(file_path, index=False, encoding='utf-8-sig')
        print("âœ¨ [å¡«å¯«æˆåŠŸ] Title, Tags, Price, Summary, Rating, Badge, Reviews å…¨æ•¸æ ¡æº–ï¼")
        
    except Exception as e:
        print(f"âŒ éŒ¯èª¤: {e}")

if __name__ == "__main__":
    ultimate_sync()