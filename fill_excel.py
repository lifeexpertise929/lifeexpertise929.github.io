import pandas as pd
import os

# æª”æ¡ˆè·¯å¾‘
file_path = 'products.csv'

try:
    # è®€å–ä¸¦æ¸…æ´—æ¬„ä½ç©ºæ ¼
    df = pd.read_csv(file_path, encoding='utf-8-sig')
    df.columns = df.columns.str.strip()
    print(f"ğŸ“Š æˆåŠŸè®€å– CSVï¼Œç›®å‰å…±æœ‰ {len(df)} ç­†è³‡æ–™ã€‚")
except Exception as e:
    print(f"âŒ è®€å–å¤±æ•—: {e}")
    exit()

def smart_fill(row):
    # å–å¾—æ¨™é¡Œé€²è¡Œæ¯”å°
    title = str(row.get('title', '')).lower()
    
    # å®šç¾©çŸ¥è­˜åº« (å°æ‡‰ä½ çš„æ¨™é¡Œé—œéµå­—)
    kb = {
        "å¿…å‹å®¢": ("ğŸ• è²·ä¸€é€ä¸€èµ·", "2025 å¿…å‹å®¢éš±è—å„ªæƒ ç¢¼ï¼šåŒ…å«å¤–å¸¶è²·ä¸€é€ä¸€ã€æ¯”è–©å¥—é¤æŠ˜åƒ¹åˆ¸å¯¦æ¸¬å¯ç”¨ã€‚", "4.6", "10è¬+ é£Ÿå®¢å¥½è©•"),
        "è‚¯å¾·åŸº": ("ğŸ— æ¿€çœ 5 æŠ˜èµ·", "è‚¯å¾·åŸºä»£ç¢¼å¤§å…¨ï¼šç‚¸é›ã€è›‹å¡”ã€å€‹äººé¤é€šé€šæœ‰å„ªæƒ ï¼Œå¯¦æ¸¬ä»£ç¢¼å¯ç”¨ã€‚", "4.5", "8è¬+ ç”¨æˆ¶æ¨è–¦"),
        "kfc": ("ğŸ— æ¿€çœ 5 æŠ˜èµ·", "è‚¯å¾·åŸºä»£ç¢¼å¤§å…¨ï¼šç‚¸é›ã€è›‹å¡”ã€å€‹äººé¤é€šé€šæœ‰å„ªæƒ ï¼Œå¯¦æ¸¬ä»£ç¢¼å¯ç”¨ã€‚", "4.5", "8è¬+ ç”¨æˆ¶æ¨è–¦"),
        "pizzahut": ("ğŸ• è²·ä¸€é€ä¸€èµ·", "2025 å¿…å‹å®¢éš±è—å„ªæƒ ç¢¼ï¼šåŒ…å«å¤–å¸¶è²·ä¸€é€ä¸€ã€æ¯”è–©å¥—é¤æŠ˜åƒ¹åˆ¸å¯¦æ¸¬å¯ç”¨ã€‚", "4.6", "10è¬+ é£Ÿå®¢å¥½è©•"),
        "è¦çš®": ("ğŸ å…é‹å„ªæƒ ä¸­", "è¦çš®è³¼ç‰© 2025 å…é‹åˆ¸ã€æŠ˜åƒ¹åˆ¸é ˜å–æ”»ç•¥ã€‚åŒ…å«å•†åŸæŠ˜æ‰£ç¢¼èˆ‡é™æ™‚ç‰¹è³£è³‡è¨Šã€‚", "4.8", "200è¬+ è²·å®¶æ¨è–¦"),
        "klook": ("âœˆï¸ ç¾æŠ˜ $100", "KLOOK å…¨çƒæ—…éŠå„ªæƒ ç¢¼ï¼šåŒ…å«åœ‹å¤–æ™¯é»é–€ç¥¨ã€äº¤é€šç¥¨åˆ¸éš±è—æŠ˜æ‰£ã€‚", "4.8", "60è¬+ æ—…äººå¥½è©•"),
        "kkday": ("âœˆï¸ æ»¿é¡æŠ˜ $100", "2025 æ—…éŠå¿…å‚™ KKDAY å„ªæƒ æ¸…å–®ï¼ŒåŒ…å«å…¨çƒä¸€æ—¥éŠé«”é©—èˆ‡æ©Ÿå ´æ¥é€æŠ˜æ‰£ã€‚", "4.7", "30è¬+ æ—…äººæ¨è–¦"),
        "yahoo": ("ğŸ’° é ˜åˆ¸æŠ˜ 15%", "YAHOO è³¼ç‰©ä¸­å¿ƒé ˜åˆ¸æ•™å­¸ï¼šéš±è—ç‰ˆ 15% å›é¥‹é ˜å–æµç¨‹å¯¦æ¸¬ã€‚", "4.4", "15è¬+ æœƒå“¡è©•é‘‘")
    }

    # æ ¹æ“šä½ çš„ CSV æ¬„ä½åç¨±é€²è¡Œå¡«å……
    for key, val in kb.items():
        if key in title:
            # ä½ çš„æ¬„ä½æ˜¯: price, summary, rating, badge
            # æ³¨æ„ï¼šä½  CSV è£¡çš„ data_source å…¶å¯¦å«åš badge
            targets = {
                'price': val[0],
                'summary': val[1],
                'rating': val[2],
                'badge': val[3]  # å°‡æ•¸æ“šä¾†æºå¡«å…¥ä½ çš„ badge æ¬„ä½
            }
            
            for col, content in targets.items():
                if col in df.columns:
                    # å¦‚æœè©²æ ¼æ˜¯ç©ºçš„ (NaN) æˆ– ç©ºå­—ä¸²ï¼Œå°±è£œä¸Š
                    if pd.isna(row[col]) or str(row[col]).strip() == "" or str(row[col]) == "nan":
                        row[col] = content
            break
    return row

# åŸ·è¡Œå¡«å……
df = df.apply(smart_fill, axis=1)

# å¼·åˆ¶å°‡ rating è½‰ç‚ºå­—ä¸²é¿å…å„²å­˜éŒ¯èª¤
if 'rating' in df.columns:
    df['rating'] = df['rating'].astype(str).replace('nan', '')

# å¯«å› CSV
df.to_csv(file_path, index=False, encoding='utf-8-sig')
print("âœ¨ [å®Œæˆ] è³‡æ–™å·²å¡«å…¥ï¼è«‹é‡æ–°æ‰“é–‹ Excel æª¢æŸ¥ 'rating' èˆ‡ 'badge' æ¬„ä½ã€‚")